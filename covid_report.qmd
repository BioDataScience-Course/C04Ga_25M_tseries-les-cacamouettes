---
title: "___"
author: "Abraham Romane, Dechèvres Florine, Desterke Margot, Viseur Zoé"
format:
  pdf:
    documentclass: report
    toc: true
editor: visual
lang: fr
---

<!--# Ce travail doit faire entre 15 et 20 pages.-->

<!--# Un rapport est différent d'un carnet de notes. Il ne s'agit donc pas de faire du copier-coller d'un document vers l'autre. Un rapport de synthèse doit être compréhensible sans devoir lire le carnet de notes. Le rapport de synthèse doit être  rédigé avec un style et une présentation adéquats. -->

## Introduction

<!--% Rédigez l'introduction de ce rapport.-->

Début 2020, la pandémie de Covid-19 fait son entrée frappante, ébranlant le monde entier. La Belgique ne fut pas épargnée. Face à cette menace, la population est contrainte de limiter ses déplacements, impactant tous les aspects de la vie quotidienne.

Les rapports de mobilité [@google_covid19_mobility] ont fourni les données présentant l'évolution de la mobilité durant cette période en Wallonie. Quatre types de lieux nous intéressent particulièrement : Commerces et loisirs, Alimentation et pharmacie, Lieux de résidence, et Lieux de travail. Ces lieux représentent en effet les aspects Activités, Besoins de première nécessité, Isolement, et Travail, nous donnant de bons aperçus de l'impact de cette pandémie dans la vie quotidienne.

## But

<!--% Rédigez le but de ce rapport.-->

## Matériel et méthodes

<!--% Cette section doit comprendre deux parties. La première partie doit expliciter le données employées et la seconde traiter des analyses réalisées et des logiciels employés.-->

Les données analysées sont issues de Google : <https://www.google.com/covid19/mobility>

Ces données sont complétées par deux rapports descriptifs distincts, l’un pour 2020 et l’autre pour 2021.

<https://www.gstatic.com/covid19/mobility/2020-11-13_BE_Wallonia_Mobility_Report_fr.pdf>

<https://www.gstatic.com/covid19/mobility/2021-11-26_BE_Wallonia_Mobility_Report_fr.pdf>

Ces données contiennent des informations relatives aux déplacements de la population wallonne en Belgique au cours des années 2020 et 2021, période marquée par la pandémie de Covid-19.

L’analyse est réalisée à l’aide de la SciViews Box 2025 dans l’environnement Saturn Cloud (Linux), en utilisant le logiciel R (R.version.string). Le package {pastecs} version r packageVersion("pastecs") est utilisé pour l’étude des séries temporelles.

## Résultats

<!--% Présentez les analyses les plus pertinents que vous avez sélectionnés. Structurez la section en partie avec des titres explicites de niveau trois.-->

```{r setup, include=FALSE}
# Nécessaire pour les tests SDD, ne pas utiliser dans un "vrai" projet
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))
# Configuration de l'environnement
SciViews::R("ts")
```

```{r import}
covid <- read("data/mobility_wallonia.rds")
skimr::skim(covid)
```

```{r}
#rename variables A ENLEVER ?????
srename(covid, 
 shop_leisure = retail_and_recreation_percent_change_from_baseline,
 grocery_pharma = grocery_and_pharmacy_percent_change_from_baseline,
 parks = parks_percent_change_from_baseline,
 stations = transit_stations_percent_change_from_baseline,
workplaces =  workplaces_percent_change_from_baseline,
 residential = residential_percent_change_from_baseline) -> covid
```

###Lieux de travail

Les déplacements envers le lieux de travail seront analysés uniquement sur la semaine et non le week-end autant en 2020 que 2021.

```{r semaine}

# Copie de la série initiale sous une autre nom
covidw <- covid
# Calcul des jours de la semaine
covidw$weekdays <- weekdays(as.POSIXct(covidw$date))
# Les données du week-end sont remplacées par des valeurs manquantes
covidw[covidw$weekdays == "Saturday" | covidw$weekdays == "Sunday" , 2:7] <- NA 
```

```{r agrega_2020}
# La série temporelle est créée (début le 15 février 2020 = 46e jour de l'année 2020)
covidw_ts <- ts(covidw$workplaces, start = c(2020, 46), frequency = 365,end = c(2020, 365))
# Aggrégation par moyenne des valeurs par semaine
covidwork_2020 <- aggregate(covidw_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
```

```{r agrega_2021}
# La série temporelle est créée (début le 1er janvier 2021)
covidw_ts21 <- ts(covidw$workplaces, start = c(2021, 1), frequency = 365,end = c(2021, 365))
# Aggrégation par moyenne des valeurs par semaine
covidwork_2021 <- aggregate(covidw_ts21, 52, FUN = collapse::fmean, ts.eps = 1/52)
```

####Comparaison générale 2020-2021 lieux de travail

```{r medianetravail_2020_2021}
covidw2020 <- tsd(covidwork_2020, method = "median", order = 5, times = 1)
plot(covidw2020, stack = FALSE, resid = FALSE, col = 1:2, main = "Décomposition-2020", ylab = "Série", xlab = "Temps [semaines]")

covidw2021 <- tsd(covidwork_2021, method = "median", order = 5, times = 1)
plot(covidw2021, stack = FALSE, resid = FALSE, col = 1:2, main = "Décomposition-2021", ylab = "Série", xlab = "Temps [semaines]")

par(mfrow = c(1, 2))
```

La décomposition par moyenne mobile montre des transitions similaires pour 2020 et 2021. En effet, une diminution de la fréquentation des lieux de travail est observée en début d'année 2020, suivie d'une augmentation vers la onzième semaine, et puis d'un plateau d'environ 10 semaines à partir de la 18ème semaine. Ensuite, une augmentation des déplacements vers les lieux de travail apparait entre la 28ème et la 32ème semaine pour ensuite se stabiliser le reste de l'année. Pour 2021, c'est exactement le même schéma, si ce n'est que les différentes transitions ne se déroulent pas toujours à la même semaine près.

Étant donné que la série diminue drastiquement en début d'année et semble tendre à ré augmenter le reste de l'année tant pour 2020 que 2021, comparons la tendance générale pour ces deux années :

```{r comparaison tendance 2020_21}
mts_2020 <- tseries(covidw2020)
trend.test(mts_2020[,"filtered"])
mtsw_2021 <- tseries(covidw2021)
trend.test(mtsw_2021[,"filtered"])
```

Les tendances générales sont croissantes et significatives tant en 2020 qu'en 2021 avec une p-value inférieure au seuil \alpha de 5% et avec une valeur \rho positive.

Il est étonnant de voir que la tendance générale est à l'augmentation autant en 2020 et 2021 car, en début d'année, les déplacements envers les lieux de travail semblent diminuer. Ces résultats laissent penser que la population n'a pas été impactée négativement pas le covid-19. Pour s'en assurer, nous allons nous attarder sur deux périodes plus réduites, une première de janvier (février pour 2020) à juin, puis une deuxième de fin juin à décembre.\
####Comparaisons par période #####Période 1 Réduction de la série de janvier/février à juin :

```{r travail_fevrier_juin}
work2020_window <-window(covidwork_2020, start = c(2020,1), end = c(2020, 20))
workwindow2020_decomp <- tsd(work2020_window, method = "median", order = 5, times = 1)
plot(workwindow2020_decomp, col = 1:3, xlab = "Temps [semaines] 2020")

work2021_window <-window(covidwork_2021, start = c(2021,1), end = c(2021, 26))
workwindow2021_decomp <- tsd(work2021_window, method = "median", order = 5, times = 1)
plot(workwindow2021_decomp, col = 1:3, xlab = "Temps [semaines] 2021")
```

Autant en 2020 que 2021, les résidus ne contiennent pas de cycles pour la période de janvier/février à juin. Concernant la composante filtrée, en 2020, elle semble présenter une diminution. En 2021, la composante filtrée diminue, puis augmente pour se stabiliser ensuite.

Nous vérifions donc la significativité des tendances générales pour 2020 et 2021 pour la période de janvier/février à juin :

```{r tendances_periode_1}
mts_windowwork2020 <- tseries(workwindow2020_decomp)
trend.test(mts_windowwork2020[,"filtered"])

mts_windowwork2021<- tseries(workwindow2021_decomp)
trend.test(mts_windowwork2021[,"filtered"])
```

La première période de 2020 présente une tendance générale significative et décroissante avec une p-value inférieure au seuil \alpha de 5% et une valeur \rho négative. Par contre, il n'y a pas de tendance générale de janvier à juin 2021.

#####Période 2

Réduction de la série de fin juin à décembre :

```{r travail_juin_decembre}
work2020_window2 <-window(covidwork_2020, start = c(2020,21), end = c(2020, 45))
workwindow22020_decomp <- tsd(work2020_window2, method = "average", order = 5, times = 3)
plot(workwindow22020_decomp, col = 1:3, xlab = "Temps [semaines] 2020")


work2021_window2 <-window(covidwork_2021, start = c(2021,27), end = c(2021, 52))
workwindow2021jd_decomp <- tsd(work2021_window2, method = "average", order = 9, times = 1)
plot(workwindow2021jd_decomp, col = 1:3, xlab = "Temps [semaines] 2021")

```

En 2020, la composante filtrée semble présenter une tendance à l'augmentation entre fin juin et décembre. En 2021, durant la même période, la série semble présenter une tendance à la diminution.

Vérifions si les tendances sont significatives :

```{r tendances_periode_2}
mts_windowwork22020 <- tseries(workwindow22020_decomp)
trend.test(mts_windowwork22020[,"filtered"])

mts_windowwork2021jd<- tseries(workwindow2021jd_decomp)
trend.test(mts_windowwork2021jd[,"filtered"])
```

En 2020 et 2021, entre juin et décembre, les tendances générales sont significatives avec des p-value inférieures au seuil \alpha de 5%. En 2020, la tendance générale est croissante avec une valeur \rho positive, alors que la tendance est décroissante en 2021 avec une valeur \rho négative.

###Lieux de résidence La population est susceptible de quitter sa résidence tous les jours de la semaine (travail, commerces, ...). Les analyses se feront donc sur les jours de la semaine et jours de weekend sans distinction. ####Année 2020

```{r serie_résid_2020}
res_20 <- ts(window(covid$residential, start = 1, end = 321),start = c(2020, 46), end = c(2020, 366), frequency = 366)
plot(res_20, xlab = "Temps [mois]", ylab = "Evolution du nombre de personnes [%]", main = "Lieux de résidence - 2020")
```

Nous pouvons déjà observer une brusque augmentation de près de 30% vers le mois de février, cohérent avec l'arrivée de la quarantaine. Une réduction de cette augmentation est visible vers le mois d'août.

Le bruit gênant notre analyse, nous réalisons une décomposition de la série avec un filtrage par les valeurs propres. Nous jetons également un oeil à l'autocorrélation.

```{r tsd_2020}
res_20_dec <- tsd(res_20, method = "evf", lag = 20, axes = 1)
plot(res_20_dec, xlab = "Temps [jours]", col = 1:3)
```

```{r acf_2020}
acf(res_20, main = "Autocorrélation pour l'année 2020")
```

La décomposition nous apprend qu'une tendance générale domine la série. Le graphe d'autocorrélation nous indique qu'il existe une forte autocorrélation dans les données, avec des barres toutes positives et significatives, confirmant la présence d'une tendance générale dans la série. La composante filtrée nous apprend cependant que cette tendance varie localement. Nous réalisons donc une analyse par la méthode des sommes cumulées.

```{r}
res_20_lt <- local.trend(res_20, xlab = "Temps [mois]")
```

Deux phases principales sont visibles. La première consiste en une augmentation à partir de début février. La seconde consiste en une diminution qui survient à la transition juillet-août. Une diminution est également observable en janvier, ainsi qu'une légère augmentation début octobre. ####Année 2021

```{r serie_2021}
res_21 <- ts(window(covid$residential, start = 322, end = 686),start = c(2021, 1), end = c(2021, 365), frequency = 366)
plot(res_21, xlab = "Temps [mois]", ylab = "Evolution du nombre de personnes [%]", main = "Lieux de résidence - 2021")
```

A première vue, on observe une tendance à la diminution jusqu'au mois de septembre, suivie d'une augmentation. Pour vérifier ces observations et éliminer le bruit, nous réalisons une décomposition de la série avec un filtrage par les valeurs propres, ainsi qu'un graphe d'autocorrélation.

```{r tsd_2021}
res_21_dec <- tsd(res_21, method = "evf", lag = 20, axes = 1)
plot(res_21_dec, col = 1:3, xlab = "Temps [jours]")
```

```{r acf_2021}
acf(res_21, main = "Autocorrélation pour l'année 2021")
```

La décomposition détermine bien la présence d'une tendance générale dominant la série, mais cette tendance est également variable localement. L'autocorrélation est forte, avec toutes les barres positives et significatives, confirmant la présence d'une tendance générale. Afin de mieux comprendre ces changements de tendance, nous réalisons une analyse par la méthode des sommes cumulées.

```{r}
res_21_lt <- local.trend(res_21, xlab = "Temps [mois]")
```

Nous observons deux phases principales. La première consiste en une augmentation, culminant vers le mois de mai. La deuxième consiste en une diminution. Nous remarquons également que la courbe stagne en fin d'année. ####Comparaison des années 2020 et 2021 Les années 2020 et 2021 sont toutes deux dominées par plusieurs tendances locales.

Début février 2020, on observe une augmentation de 30% du nombre de personnes restant à leur domicile. A la transition juin-juillet, la tendance diminue ensuite pour atteindre son taux le plus bas vers le mois d'août, période où la population sortait plus afin de profiter du beau temps. La tendance remonte début octobre, illustrant la reprise du travail via les cours en ligne ou le télé-travail, pour un grand pourcentage de la population.

L'année 2021 débute avec un taux d'augmentation d'environ 15%, qui grimpe jusqu'à culminer au mois de mai. On observe ensuite une forte chute de l'augmentation qui finit par atteindre un pallier en fin d'année. Cette brusque diminution résulte de l'allègement des mesures relatives à la pandémie, avec notamment la reprise totale des cours en présentiel pour les étudiants.

En résumé, l'année 2020 connut le plus grand taux d'augmentation du nombre de personnes restant à leur domicile. Une légère diminution était déjà observable en 2021, permise par les progrès médicaux et les premiers effets de l'immunité collective. De plus, pour les deux années confondues, la période estivale s'est avérée être la période avec le taux d'augmentation le plus faible. \## Discussion et Conclusion

<!--% En tenant compte du but de votre carnet de notes et de vos résultats, discutez de résultats et proposez des conclusions à votre analyse en 5 à 10 phrases. -->
