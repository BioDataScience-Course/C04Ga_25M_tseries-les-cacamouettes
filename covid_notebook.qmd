---
title: "___"
author: "Abraham Romane, Dechèvres Florine, Desterke Margot, Viseur Zoé"
format:
  html:
    code-fold: true
    code-tools: true
    toc: true
editor: visual
lang: fr
---

<!--# Ceci est un commentaire. -->

<!--% Ceci est une consigne. Ne jamais modifier ni déplacer les consignes dans le document ! -->

<!--% Complétez le titre et le nom des auteurs (auteur1, auteur2, auteur3 et auteur 4) dans l'entête YAML.-->

## Introduction et but

<!--% Rédigez une courte introduction de 3 ou 5 phrases qui présente vos données. Ajoutez une phrase de but. Vous devez citer la bibliographie en utilisant le formatage Markdown ad hoc et en incluant votre référence au format bibtex dans le fichier references.bib. -->

De 2020 à 2022, la pandémie de Covid-19 a ébranlé le monde, forçant la population à limiter ses déplacements. Les données fournies par les rapports de mobilité [@google_covid19_mobility] présentent l'évolution de la mobilité durant cette période pour différentes provinces de Wallonie, et ce pour différents lieux. Nous nous intéresserons ici aux commerces et loisirs, alimentation et pharmacie, lieux de résidence, et lieux de travail.

Dans cette étude, nous tenterons de quantifier l'impact qu'a eu le Covid-19 sur les déplacements de personnes en Belgique, Wallonie, du 15 février 2020 au 31 décembre 2021.

## Matériel et méthodes

<!--% Indiquez ici d'où viennent les données et aussi quel logiciel (et version) vous utilisez pour les analyses. Inspirez-vous des projets déjà réalisés. -->

Les données proviennent de Google : <https://www.google.com/covid19/mobility/>

De plus, elles sont accompagnées de descriptifs sous forme de deux rapports, chacun correspondant à une année, 2020 et 2021 : <https://www.gstatic.com/covid19/mobility/2020-11-13_BE_Wallonia_Mobility_Report_fr.pdf>

<https://www.gstatic.com/covid19/mobility/2021-11-26_BE_Wallonia_Mobility_Report_fr.pdf>

Ces données renferment des informations liées aux déplacements de la population wallone en Belgique, durant les années 2020 et 2021, période durant laquelle la pandémie du Covid-19 était d'actualité.

L'analyse est réalisée avec la SciViews Box 2025 dans Saturn Cloud (Linux), utilisant le logiciel R (r R.version.string). Le package {pastecs} version r packageVersion("pastecs") est utilisé pour étudier la série temporelle.

## Analyses

<!--% Lisez bien les éléments devant guider votre analyse proposée dans le README.-->

```{r setup, include=FALSE}
# Nécessaire pour les tests SDD, ne pas utiliser dans un "vrai" projet
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))
# Configuration de l'environnement
SciViews::R("ts")
```

```{r import}
covid <- read("data/mobility_wallonia.rds")
skimr::skim(covid)
```

Interprétation :

Notre jeu de données est composé de septs variables dont six numériques et une caractère. On retrouve deux valeurs manquantes.

```{r}
#rename variables
srename(covid, 
 shop_leisure = retail_and_recreation_percent_change_from_baseline,
 grocery_pharma = grocery_and_pharmacy_percent_change_from_baseline,
 parks = parks_percent_change_from_baseline,
 stations = transit_stations_percent_change_from_baseline,
workplaces =  workplaces_percent_change_from_baseline,
 residential = residential_percent_change_from_baseline) -> covid
```

Graphique d'auto-correlation

```{r correlation}

```

<!--% Ajoutez le nombre de chunks que vous souhaitez. Répartissez-vous le travail correctement. Structurez la section en partie avec des titres explicites de niveau trois.-->

##Analyse par variable :

Retenir les jours de la semaine :

```{r semaine}

# Copie de la série initiale sous une autre nom
covidw <- covid
# Calcul des jours de la semaine
covidw$weekdays <- weekdays(as.POSIXct(covidw$date))
# Les données du week-end sont remplacées par des valeurs manquantes
covidw[covidw$weekdays == "Saturday" | covidw$weekdays == "Sunday" , 2:7] <- NA 
```

Retenir les jours du week-end :



Retenir les jours du week-end : 
```{r weekend}
# Copie de la série initiale sous une autre nom
covidy <- covid
# Calcul des jours de la semaine
covidy$weekdays <- weekdays(as.POSIXct(covidy$date))
# Les données du week-end sont remplacées par des valeurs manquantes
covidy[covidy$weekdays == "Monday" | covidy$weekdays == "Tuesday" | covidy$weekdays == "Wednesday" | covidy$weekdays == "Thursday" | covidy$weekdays == "Friday", 2:7] <- NA 

# Aggrégation par moyenne des valeurs par semaine
# covidy_ts2 <- aggregate(covidy_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
```

###Commerces et loisirs

```{r serie 2020}
shop_ts <- ts (covid$shop_leisure, start = c(2020, 46),end = c(2020, 366), frequency = 366 )
plot (shop_ts)
```

```{r serie 2020 week}
shopw_ts <- ts (covidy$shop_leisure, start = c(2020, 46),end = c(2020, 366), frequency = 366 )
shopy_ts <- aggregate(covidy_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot (shopw_ts)
```

###Lieux de travail
La variable Lieux de travail correspond aux déplacements de la population wallone, en Belgique, vers leur lieu de travail. Nous allons comparer ces déplacements pour l'année 2020 et 2021.
####Année 2020
```{r série travail 2020}
ts_work <- ts(covid$workplaces, start = c(2020, 46), frequency = 366, end = c(2020, 365))
plot(ts_work, xlab = "Temps [mois]", ylab = "Déplacements", main = "Année 2020 - Déplacements vers le lieu de travail")
tsp(ts_work)
```

La série concernant les déplacements vers les lieux de travail présente beaucoup de bruit ce risque risque de rendre l'analyse difficile. Nous allons donc tenter de garder uniquement les jours de la semaine :

```{r Aggrégation semaine 2020}
# La série temporelle est créée (début le 15 février 2020 = 46e jour de l'année 2020)
covidw_ts <- ts(covidw$workplaces, start = c(2020, 46), frequency = 365,end = c(2020, 365))
# Aggrégation par moyenne des valeurs par semaine
covidwork_2020 <- aggregate(covidw_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidwork_2020, xlab = "Temps [mois]", ylab = "Déplacements", main = "Année 2020 - Déplacements vers le lieu de travail")
```

Nous voyons qu'en ne gardant que les jours de la semaine, le bruit de la série est réduit. Nous continuerons donc nos analyses sur les valeurs moyennes de déplacements au travail uniquement la semaine autant pour 2020 que 2021.
Nous voyons que début 2020, les déplacements vers les lieux de travail a chuté brutalement pour ensuite connaitre deux remontées progressives durant le printemps et jusqu'à la fin de l'été. Enfin, une rechute moins marquée que la première est observée vers la fin de l'été. Puis, les déplacements vers les lieux de travail réaugmente fin 2020.

```{r acf travail 2020 }
acf(covidwork_2020)
```
Ce graphique d'autocorrélation ne semble pas présenter de cycle. Par contre, les barres significatives au début décroissent, ce qui pourrait se traduire par une tendance générale décroissante. De plus, les autres barres sont non significatives.

Nous réalisons une décomposition de la série afin d'analyser cette dernière plus en détail :

```{r décomposition 2020}
covidw2020 <- tsd(covidwork_2020, method = "average", type = "additive", order = 26, times = 3)
plot(covidw2020, col = 1:3)
```
La composante filtered qui représente la série d'origine sans les cycles, semblent présenter une tendance générale. De plus, les résidus semblent présenter des cycles.
Nous convertissons notre objet en mts pour ensuite regarder l'autocorrélation de la composante filtrée.

```{r tendance générale 2020}
 mts_2020 <- tseries(covidw2020)
class(mts_2020)
plot(mts_2020)
 acffiltre_work_2020 <-acf(mts_2020[, "filtered"])
```
La série présente une tendance générale qui semble croissante lorsque l'on observe la composante filtrée.
Quant au graphique de l'autocorrélation il semble présenter une autocorrélation significative et positive.
Concernant les résidus, la série semble présenter des cycles.

```{r}
trend.test(mts_2020[,"filtered"])
```
La p-value étant inférieure au seuil \alpha de 5% pour la composante filtrée,nous rejetons H0. La tendance générale à l'augmentation est donc significative.

```{r}
acfresidu_work_2020 <-acf(mts_2020[, "residuals"])
```


```{r analyse résidus 2020}
 covid_extract_2020 <-extract(covidw2020, components = "residuals")
plot(covid_extract_2020)
spectrum(covid_extract_2020, spans = c(3,5))
```


####Année 2021
```{r série semaine 2021}
# La série temporelle est créée (début le 1er janvier 2021)
covidw_ts <- ts(covidw$workplaces, start = c(2021, 1), frequency = 365,end = c(2021, 365))
# Aggrégation par moyenne des valeurs par semaine
covidwork_2021 <- aggregate(covidw_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidwork_2021, xlab = "Temps [mois]", ylab = "Déplacements", main = "Année 2021 - Déplacements vers le lieu de travail")
```
La série présente une chute des déplacements envers les lieux de travail début 2021. Puis, cela augmente progressivement jusqu'au début de l'été. Pour ensuite rechuter, moins fort que la première fois et après remonter vers la fin de l'été. Ensuite, une autre rechute, plus forte que la dernière apparaît pour ensuite remonter à la fin de l'année 2021.


```{r acf travail 2021 }
acf(covidwork_2021)
```
Ce graphique d'autocorrélation est très semblable à celui de 2020. Il ne semble pas non plus y avoir de cycles. De plus, uniquement les deuxième et troisième barres sont significatives et diminuent, ce qui pourrait, comme 2020, se traduire par une tendance générale négative.




###Alimentation et pharmacies

####Année 2020 

```{r}
grocery_pharma_ts <- ts(covid$grocery_pharma, start = c(2020, 46), frequency = 365, end = c(2020, 365))
plot(grocery_pharma_ts, ylab = "déplacement supermarchés et pharmacies", xlab = "temps [mois]", main = "Année 2021 - déplacement supermarchés et pharmacies")
```
Ce graphique représente l'évolution des déplacements vers les supermarchés et les pharmacies durant l'année 2020 en période de covid. On aperçoit une chute brutale de la série un peu avant le mois de mars. Ensuite, la série se stabilise autour d'une tendance négative, puis, elle remonte légèrement à la fin de l'année. On observe également un pic au début du mois de février. 

```{r}
covidw_ts <- ts(covidw$grocery_pharma, start = c(2020, 46), frequency = 365,end = c(2020, 365))
plot(covidw_ts)
# Aggrégation par moyenne des valeurs par semaine
covidw_gp_ts2 <- aggregate(covidw_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidw_gp_ts2)

covidy_ts <- ts(covidy$grocery_pharma, start = c(2020, 46), frequency = 365,end = c(2020, 365))
plot(covidw_ts)
# Aggrégation par moyenne des valeurs par semaine
covidy_gp_ts2 <- aggregate(covidy_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidy_gp_ts2)

par(mfrow = c(1, 2), mar = c(4, 4, 3, 1))
plot(covidw_gp_ts2, ylab = "déplacement supermarchés et pharmacies", xlab = "temps [mois]", main = "Année 2020 - déplacement supermarchés et pharmacies semaine")
plot(covidy_gp_ts2, ylab = "déplacement supermarchés et pharmacies", xlab = "temps [mois]", main = "Année 2020 - déplacement supermarchés et pharmacies week-end")
```
Lorsque l'on compare la variable alimentation et pharmacies entre la semaine et le week-end, on remarque que les deux séries évoluent de manière similaire. De ce fait, nous pouvons continuer les analyses en ne séparant pas les jours de la semaine et les week-end. On observe une forte chute un peu avant le mois de mars. Ensuite, les deux séries remontent pour se stabiliser autour d'une tendance négative puis elles remontent légèrement à la fin de l'année 2020. Cela suggère que les gens vont à la pharmacie et vont chercher des aliments tant le week-end que la semaine. Le moment de la chute correspond au début des premières mesures sanitaires prises vis-à-vis de ces virus avant la confinement officiel. Cela pourrait être lié à une peur collective quant à la gravité de la situation. 

####Année 2021

```{r}
grocery_pharma_ts2 <- ts(covid$grocery_pharma, start = c(2021, 1), frequency = 365, end = c(2021, 365))
plot(grocery_pharma_ts2, ylab = "déplacement supermarchés et pharmacies", xlab = "temps [mois]", main = "Année 2021 - déplacement supermarchés et pharmacies")
```
Ce graphique montre l'évolution des déplacements vers les supermarchés et les pharmacies durant l'année 2021 en période covid. Lorsque l'on observe de manière générale, nous apercevons trois pics : un autour du 12 janvier et deux autour du milieu du mois d'août. Quand on regarde l'évolution de la série, on voit une forte chute au milieu du mois de janvier qui pourrait correspondre aux mesures sanitaires plus strictes mises en place après les fêtes de fin d'années. Ensuite, la série remonte et elle se stabilise autour d'une tendance générale négative jusqu'en août où le deuxième et le troisième pics sont visibles pour après reprendre la tendance générale négative. 

####Comparaison année 2020 et année 2021

```{r}
grocery_pharma_ts <- ts(covid$grocery_pharma, start = c(2020, 46), frequency = 365, end = c(2020, 365))
plot(grocery_pharma_ts)

grocery_pharma_ts2 <- ts(covid$grocery_pharma, start = c(2021, 1), frequency = 365, end = c(2021, 365))
plot(grocery_pharma_ts2)


par(mfrow = c(1, 2), mar = c(4, 2.5, 3, 1))
plot(grocery_pharma_ts, ylab = "déplacement supermarchés et pharmacies", xlab = "temps [mois]", main = "Année 2020 - déplacement supermarchés et pharmacies")
plot(grocery_pharma_ts2, ylab = "déplacement supermarchés et pharmacies", xlab = "temps [mois]", main = "Année 2021 - déplacement supermarchés et pharmacies")

```
Lorsque l'on compare la forme générale de la série pour l'année 2020 et la série pour pour l'année 2021, l'aspect globale semble évoluer de manière similaire. En effet, même si la chute n'a pas lieu au même moment (2020 : février, 2021 : janvier), la baisse brutale de déplacement vers les supermarchés et les pharmacies est observable en début d'année dans les deux séries. Ensuite, tant pour 2020 que pour 2021, la série se stabilise autour d'une tendance générale pour, à la fin  de l'année, remonter légèrement. 

```{r}
#j'ai pas fini
par(mfrow = c(1, 2))
boxplot(as.numeric(grocery_pharma_ts), 
  main = "déplacements supermarchés et pharmacies 2020")
boxplot(as.numeric(grocery_pharma_ts2),
  main = "déplacements supermarchés et pharmacies 2021")

```


###Lieux de résidence

####Année 2020

```{r}
res_20 <- ts(covid[, "residential"], start = c(2020, 46), end = c(2020, 366), frequency = 366)
class(res_20)
```

Que ce soit pour le travail ou pour d'autres activités, la population quitte sa résidence globalement tous les jours de la semaine. Nous ne séparons donc pas les données entre jours de la semaine et jours de weekend. Jetons un oeil à cette série chronologique en imprimant son graphe.

```{r}
plot(res_20)
```

A cette étape, il est encore très difficile d'interpréter la série chronologique. Cependant, nous observons une brusque augmentation de personnes restant chez elles début d'année 2020, illustrant l'arrivée soudaine de la quarantaine.

<<<<<<< HEAD
#Année 2021

=======
####Année 2021
>>>>>>> 8dec2c4fc4f9a779eb1a734fa14620c19dac4d4b
```{r}
res_21 <- ts(covid[, "residential"], start = c(2021, 1), end = c(2021, 365), frequency = 365)
class(res_21)
```

Imprimons le graphe de cette série chronologique.

```{r}
plot(res_21)
```

Tout comme pour l'année 2020, on observe une forte augmentation de personnes restant chez elles en début d'année, mais il est encore trop tôt dans l'analyse pour de plus amples interprétations.

# Conclusion

<!--% Lorsque toutes les analyses sont réalisées, terminez ce bloc-notes avec 3 à 6 phrases de conclusion en rapport avec ce que vous avez observé dans vos analyses. Quels sont les éléments les plus pertinents que vous retenez ? -->

...vos conclusions ici...
