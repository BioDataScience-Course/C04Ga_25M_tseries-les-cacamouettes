---
title: "___"
author: "Abraham Romane, Dechèvres Florine, Desterke Margot, Viseur Zoé"
format:
  html:
    code-fold: true
    code-tools: true
    toc: true
editor: visual
lang: fr
---

<!--# Ceci est un commentaire. -->

<!--% Ceci est une consigne. Ne jamais modifier ni déplacer les consignes dans le document ! -->

<!--% Complétez le titre et le nom des auteurs (auteur1, auteur2, auteur3 et auteur 4) dans l'entête YAML.-->

## Introduction et but

<!--% Rédigez une courte introduction de 3 ou 5 phrases qui présente vos données. Ajoutez une phrase de but. Vous devez citer la bibliographie en utilisant le formatage Markdown ad hoc et en incluant votre référence au format bibtex dans le fichier references.bib. -->

De 2020 à 2022, la pandémie de Covid-19 a ébranlé le monde, forçant la population à limiter ses déplacements. Les données fournies par les rapports de mobilité [@google_covid19_mobility] présentent l'évolution de la mobilité durant cette période en Wallonie, et ce pour différents lieux. Nous nous intéresserons ici aux commerces et loisirs, alimentation et pharmacie, lieux de résidence, et lieux de travail.

Dans cette étude, nous tenterons de quantifier l'impact qu'a eu le Covid-19 sur les déplacements de personnes en Belgique, Wallonie, en comparant les années 2020 et 2021.

## Matériel et méthodes

<!--% Indiquez ici d'où viennent les données et aussi quel logiciel (et version) vous utilisez pour les analyses. Inspirez-vous des projets déjà réalisés. -->

Les données proviennent de Google : <https://www.google.com/covid19/mobility/>

De plus, elles sont accompagnées de descriptifs sous forme de deux rapports, chacun correspondant à une année, 2020 et 2021 : <https://www.gstatic.com/covid19/mobility/2020-11-13_BE_Wallonia_Mobility_Report_fr.pdf>

<https://www.gstatic.com/covid19/mobility/2021-11-26_BE_Wallonia_Mobility_Report_fr.pdf>

Ces données renferment des informations liées aux déplacements de la population wallone en Belgique, durant les années 2020 et 2021, période durant laquelle la pandémie du Covid-19 était d'actualité.

L'analyse est réalisée avec la SciViews Box 2025 dans Saturn Cloud (Linux), utilisant le logiciel R (r R.version.string). Le package {pastecs} version r packageVersion("pastecs") est utilisé pour étudier la série temporelle.

## Analyses

<!--% Lisez bien les éléments devant guider votre analyse proposée dans le README.-->

```{r setup, include=FALSE}
# Nécessaire pour les tests SDD, ne pas utiliser dans un "vrai" projet
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))
# Configuration de l'environnement
SciViews::R("ts")
```

```{r import}
covid <- read("data/mobility_wallonia.rds")
skimr::skim(covid)
```

Interprétation :

Notre jeu de données est composé de septs variables dont six numériques et une caractère. On retrouve deux valeurs manquantes.

```{r}
#rename variables
srename(covid, 
 shop_leisure = retail_and_recreation_percent_change_from_baseline,
 grocery_pharma = grocery_and_pharmacy_percent_change_from_baseline,
 parks = parks_percent_change_from_baseline,
 stations = transit_stations_percent_change_from_baseline,
workplaces =  workplaces_percent_change_from_baseline,
 residential = residential_percent_change_from_baseline) -> covid
```

Graphique d'auto-correlation

```{r correlation}

```

<!--% Ajoutez le nombre de chunks que vous souhaitez. Répartissez-vous le travail correctement. Structurez la section en partie avec des titres explicites de niveau trois.-->

## Analyse par variable :

Retenir les jours de la semaine :

```{r semaine}
#Isolement semaine pour 2020 : 
# Copie de la série initiale sous une autre nom
covidw <- covid
# Calcul des jours de la semaine
covidw$weekdays <- weekdays(as.POSIXct(covidw$date))
# Les données du week-end sont remplacées par des valeurs manquantes
covidw[covidw$weekdays == "Saturday" | covidw$weekdays == "Sunday" , 2:7] <- NA 
```

Retenir les jours du week-end :

```{r weekend}
# Copie de la série initiale sous une autre nom
covidy <- covid
# Calcul des jours de la semaine
covidy$weekdays <- weekdays(as.POSIXct(covidy$date))
# Les données du week-end sont remplacées par des valeurs manquantes
covidy[covidy$weekdays == "Monday" | covidy$weekdays == "Tuesday" | covidy$weekdays == "Wednesday" | covidy$weekdays == "Thursday" | covidy$weekdays == "Friday", 2:7] <- NA 

# Aggrégation par moyenne des valeurs par semaine
# covidy_ts2 <- aggregate(covidy_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
```

### Commerces et loisirs

La variable commerces et loisirs correspond aux déplacements des habitants de la régions wallonne dans des lieux de loisirs tels que les restaurants, les cafés, les centres commerciaux, les parcs à thème, les musées, les bibliothèques et les cinémas. Nous allons analyser l'évolution des déplacement aux cours de deux années charnières de la période du covid : 2020 et 2021

#### Année 2020

```{r serie_shop_2020}
#Création de la série globale :
shop_ts <- ts(
  covid$shop_leisure,
  start = c(2020, 46),
  frequency = 365
)
#Découpage de l'année 2020 : 
shop20_ts <- window(
  shop_ts,
  start = c(2020, 46),
  end   = c(2020, 365))

plot (shop20_ts, 
  col= "cadetblue4", 
  ylab = "Déplacements", 
  xlab = "Temps [mois]", 
  main = "Déplacements vers les commerces et les lieux de loisirs \n durant l'année du covid (2020)")
```

Nous pouvons observer que la série comporte du bruit qui peut créer des problèmes dans les futures analyses. Nous tentons donc de séparer cette série pour les jours de la semaine et pour les week-ends :

Séparation pour les jours de la semaine :

```{r ser20_shop_semaine}
#découpage de la série globale par semaine : 
shopw_ts <- ts(
  covidw$shop_leisure,
  start = c(2020, 46),
  frequency = 365)

#sélection pour 2020 
shopw20_ts <- window(
  shopw_ts,
  start = c(2020, 46),
  end   = c(2020, 365))

#Aggrégation par moyenne des valeurs par semaine
weekshop_2020 <- aggregate(shopw20_ts, 
  nfrequency = 52,
  FUN = collapse::fmean, 
  ts.eps = 1/52)

plot (weekshop_2020, 
  ylab = "Déplacements", 
  xlab = "Temps [mois]", 
  main = "Série hebdomadaire des déplacements pour le commerce et loisirs")

#Vérification que la série hebdomadaire est bien uniquement pour 2020 
start(weekshop_2020)
end(weekshop_2020)
length(weekshop_2020)
```

vérification supplémentaire que la série hebdomadaire est bien uniquement pour 2020 :

```{r week20_VS_weekALLYEARS}
covidw_all_ts <- ts(
  covidw$shop_leisure,
  start = c(2020, 46),
  frequency = 365
)

weekshop_all <- aggregate(
  covidw_all_ts,
  52,
  FUN = collapse::fmean,
  ts.eps = 1/52
)
#comparaison de plot 
plot(weekshop_all, col = "grey", lwd = 1,
     main = "Comparaison série complète vs 2020",
     ylab = "Déplacements", xlab = "Temps [mois]")

lines(weekshop_2020, col = "red", lwd = 2)
legend("bottomright",
       legend = c("Série complète", "Année 2020"),
       col = c("grey", "red"),
       lwd = c(1, 2),
       bty = "n")

```

Séparation pour les week-end :

```{r  ser20_shop_weekend}
#découpage de la série globale pour les weekends : 
covidy_ts <- ts(
  covidy$shop_leisure,
  start = c(2020, 46),
  frequency = 365)

#sélection pour 2020 
covidy_ts <- window(
  covidy_ts,
  start = c(2020, 46),
  end   = c(2020, 365))

# Aggrégation par moyenne des valeurs par semaine
weekendshop_2020 <- aggregate(covidy_ts, 
  52,
  FUN = collapse::fmean, 
  ts.eps = 1/52)

plot (weekendshop_2020, 
  ylab = "Déplacements", 
  xlab = "Temps [mois]", 
  main = "Série contenant les jours de week-end uniquement")

#Vérification que la série hebdomadaire est bien uniquement pour 2020 
start(weekendshop_2020)
end(weekendshop_2020)
length(weekendshop_2020)
```

Nous voyons que la sélection des jours de la semaine ou des jours du week-end a permis de réduire grandement le bruit et de mieux visualiser l'allure générale de la courbe de la série. Cependant, entre la semaine et le week-end, la série ne semble pas varier énormément, ce qui signifie que les déplacements pour les lieux de commerces et de loisirs ne varient pas beaucoup de la semaine au weekend. Nous pouvons donc nous poser la question de l'utilité réelle de séparer ces deux parties, ou de garder la série combinant la semaine et le week-end.

Réalisons des statistiques glissantes pour avoir la moyenne des différents intervale de temps le long de notre série :

```{r statslide_shop_20}
shop_sl <- stat.slide (time (shop20_ts), shop20_ts, deltat =1/12)
plot (shop_sl, stat = "mean", leg = TRUE, ylab = "Déplacements", 
  xlab = "Temps [mois]", 
  main = "Statistiques glissantes sur la série d'origine" )
lines(shop_ts, col = "gray")
```

Comparons ces statisqtiques glissantes avec les séries isolant les données de semaine et de week-end :

```{r statslide_shopweek_20}
shop_week_sl <- stat.slide (time (weekshop_2020), weekshop_2020, deltat =1/12)
plot (shop_week_sl, stat = "mean", leg = TRUE, ylab = "Déplacements", 
  xlab = "Temps [mois]", 
  main = "Statistiques glissantes sur la série contenant juste \n les données pour les semaines")
lines(weekshop_2020, col = "gray")
```

```{r statslide_shopweekend_20}
shop_weekend_sl <- stat.slide (time (weekendshop_2020), weekendshop_2020, deltat =1/12)
plot (shop_weekend_sl, stat = "mean", leg = TRUE, ylab = "Déplacements", 
  xlab = "Temps [mois]", 
  main =  "Statistiques glissantes sur la série contenant juste \n les données pour les weekends")
lines(weekendshop_2020, col = "gray")

```

Nous pouvons voir qu'entre les différentes données filtrées pour une période de la semaine ou pas, les moyennes des variation de déplacement le long de l'axe temporel de la série ne varient pas grandement. En effet, la valeur moyenne du deuxième pic dans la série excluant la semaine est juste légèrement plus en dessous de 0 que celles des deux autres types de séries.

Pour visualiser encore mieux la variation entre les séries filtrées pour la semaine et pour le week-end, nous pouvons également réaliser ceci ;

```{r superposition_20}
plot (shop20_ts, 
  col = "gray", 
  ylab = "Déplacements", 
  xlab = "Temps [mois]", 
  main = "Superposition des courbes des semaines et du weekends")
lines (weekshop_2020, col = "darkseagreen4", lwd = 2)
lines (weekendshop_2020, col = "coral3", lwd = 2)

legend(
  "topright",
  legend = c("Tous les jours", "Semaine", "Week-end"),
  col = c("gray", "darkseagreen4", "coral3"),
  lwd = c(2, 2, 2),
  bty = "n"
)
```

De nouveau, nous voyons que les deux courbes qui isolent respectivement les semaines et les weekends ne diffèrent pas tellement dans la variation du déplacement. Nous décidons donc de garder, pour la suite de l'analyse, la série complète avec les semaines et les week-ends.

Pour commencer l'analyse sur la série 2020, réalisons un test de l'autocorrelation :

```{r acf_shop_20}
acf (shop20_ts, main = "Graphique d'autocorrelation de la série pour 2020")
```

Le graphique de la fonction d'autocorrelation ne semble pas présenter de cycle, mais toutes barres sont significatives (au dessus de l'enveloppe de confiance à 95%) et positive, ce qui signifie qu'une tendance à l'augmentation domine le signal.

Il serait intéressant aussi, au vu de l'aspect général de notre graphique, de regarder si a série présence des tendances locales, différentes phases d'évolution à long terme, croissance et puis décroissance :

```{r shop20_localtrend}
shop20_local <- local.trend (shop20_ts, xlab = "Temps [mois]", ylab = "Sommes cumulées (CUSUM)", main = "Tendances locales de la série 2020 \n sur le déplacement vers les commerces et loisirs")
abline (v = c(2020.2, 2020.43, 2020.8, 2021.0), col = "red", lty = 2)
```

Effectivement, comme nous l'avions anticipé, les sommes cumulées (ligne rouge) forment un U assez net et deux pics bien marqué de chaque côté de ce U. Nous avons donc présence de plusieurs phases dans cette série : une croissance, suivit d'une décroissance marquée, puis d'une croissance aussi marquée, et enfin une légère décroissance. Les ruptures moyennes (marquées par les traits pointillé verticaux) correspondant à ces changement de phases sont environ : au 73e jour, au 156e jour, et au 292e jour jour, et un ralentissement au 328e jour. Si nous convertissons ces données de jours en mois : - Il y a eu une augmentation jusqu'en mi-mars (14 mars environ). - À partir de mi-mars, les sommes cumulées chutent drastiquement, jusque début juin (aux environs du 5 juin). - Puis, à partir du début du mois de juin jusqu'en mi-octobre, augmentation progressive. - Après la mi-octobre, on observe une nouvelle baisse des déplacements, plus progressive, pour ensuite se stabiliser (et peut-être monter très légerement) à la fin novembre.

Vérifions tout de même s'il y a présence également d'une tendance générale. Pour cela, nous réalisons une EVF qui permettra de nous dire si la série est dominée par un signal de tendance générale, de cycle ou autre. Cela permettra de nous confirmer la présence de la tendance générale, s'il y en a bien une.

```{r shop20_filtrage_evf}
shop20_evf <- tsd (shop20_ts, method = "evf", lag = 60, axes = 1)
plot (shop20_evf, col = 1:3, 
  xlab = "Temps", 
  main = "Filtrage de la série 2020 par valeur propre")
```

On peut voir un signal beaucoup plus propre apparaître, qui pourrait correspondre au signal d'une tendance générale

```{r test_tendance_shop20}
shop_evffilter <- extract (shop20_evf, components = "filtered")
plot (shop_evffilter)
plot (trend.test(shop_evffilter, R = 100))
```

Vérifions la présence de cycle dans les résidus de cette décomposition de série :

```{r}
shop20_residual <- extract (shop20_evf, components = "residuals")
plot (shop20_residual, xlab = "Temps [mois]", main = "Résidus de la décomposition de la série des déplacements en 2021")
acf (shop20_residual, main = "Autocorrelation des résidus")
spectrum (shop20_residual, spans = c(3,5), main = "Analyse spectrale des résidus pour la série 2020")
```

Pas de cycles significatifs sont présent dans cette série. La tendance générale est la seule qui domine la série ici. Il y a donc une tendance générale et des tendances locales.

Autre moyen de filtrer la tendance générale :

```{r shop20_filtrage_average}
shop_mb <- tsd (shop20_ts, method = "average", order = 50, times = 1)
plot (shop_mb, col = 1:3)
```

```{r}
shop_tfilter <- extract (shop_mb, components = "filtered")
plot (shop_tfilter)
```

```{r test_tendance_shop20}
plot (trend.test(shop_tfilter, R = 100))
```

Tout comme la décomposition par filtrage par valeurs propres, la tendance générale qui est extraite est significative au seuil \alpha de 5%. Nous rejetons H0 et considérons donc la tendance générale à l'augmentation comme significative. Nous revérifions qu'il n'y a pas de cycle pour la série, également avec cette décomposition, avec une analyse spectrale des résidus.

```{r}
shop_residual <- extract (shop_mb, components = "residuals")
plot (shop_residual)
acf (shop_residual)
spectrum (shop_residual, spans = c(3,5))
```

Les résidus ne présentent pas de cycle significatifs, tout comme les résidus qui étaient extrais avec la décomposition par filtrage par valeurs propres.

#### Année 2021

```{r serie_shop_2021}
##Découpage de l'année 2021 : 
shop21_ts <- window(
   shop_ts,
  start = c(2021, 1),
  end   = c(2021, 365))

plot (shop21_ts, 
  col= "tan3", 
  ylab = "Déplacements", 
  xlab = "Temps [mois]", 
  main = "Déplacements vers les commerces et les lieux de loisirs \n durant l'année 2021")
```

Tout comme la série 2021, nous essayons de séparer semaine et week-end pour évaluer quelle série serait la meilleure pour nos analyses :

```{r ser21_shop_semaine}
#découpage de la série globale par semaine : 
shopw_ts <- ts(
  covidw$shop_leisure,
  start = c(2020, 46),
  frequency = 365)

#sélection pour 2021 
shopw21_ts <- window(
  shopw_ts,
  start = c(2021, 1),
  end   = c(2021, 365))

#Aggrégation par moyenne des valeurs par semaine
weekshop_2021 <- aggregate(shopw21_ts, 
  nfrequency = 52,
  FUN = collapse::fmean, 
  ts.eps = 1/52)

plot (weekshop_2021, 
  ylab = "Déplacements", 
  xlab = "Temps [mois]", 
  main = "Série hebdomadaire des déplacements pour le commerce et loisirs")

#Vérification que la série hebdomadaire est bien uniquement pour 2020 
start(weekshop_2021)
end(weekshop_2021)
length(weekshop_2021)
```

Sélection des données pour le week-end :

```{r ser21_shop_weekend}
#découpage de la série globale pour les jours du week-end : 
shopy_ts <- ts(
  covidy$shop_leisure,
  start = c(2020, 46),
  frequency = 365)

#sélection pour 2021 
shopy21_ts <- window(
  shopy_ts,
  start = c(2021, 1),
  end   = c(2021, 365))

#Aggrégation par moyenne des valeurs par semaine
weekendshop_2021 <- aggregate(shopy21_ts, 
  nfrequency = 52,
  FUN = collapse::fmean, 
  ts.eps = 1/52)

plot (weekendshop_2021, 
  ylab = "Déplacements", 
  xlab = "Temps [mois]", 
  main = "Série hebdomadaire des déplacements pour le commerce et loisirs")

#Vérification que la série hebdomadaire est bien uniquement pour 2020 
start(weekendshop_2021)
end(weekendshop_2021)
length(weekendshop_2021)
```

Visualisation et comparaison de la variation entre les séries filtrées pour la semaine et pour le week-end :

```{r superposition_21}
plot (shop21_ts, 
  col = "gray", 
  ylab = "Déplacements", 
  xlab = "Temps [mois]", 
  main = "Superposition des courbes des semaines et du weekends")
lines (weekshop_2021, col = "darkseagreen4", lwd = 2)
lines (weekendshop_2021, col = "coral3", lwd = 2)

legend(
  "bottomright",
  legend = c("Tous les jours", "Semaine", "Week-end"),
  col = c("gray", "darkseagreen4", "coral3"),
  lwd = c(2, 2, 2),
  bty = "n"
)
```

Nous pouvons voir, qu'à part la fin du graphique, où la courbe du week-end descend brusquement contrairement à celle de la semaine, le reste est assez similaire entre semaine et week-end. Nous gardons donc, pour le reste de nos analyse, la série complète avec week-end et semaines compris.

Réalisons un test de l'autocorrelation pour cette série 2021:

```{r acf_shop_21}
acf (shop21_ts, main = "Graphique d'autocorrelation de la série pour 2021")
```

Tout comme la série 2020, nous pouvons voir que le graphique de la fonction d'autocorrelation présente des barres qui sont significatives (au dessus de l'enveloppe de confiance à 95%) et positives, ce qui signifie qu'une tendance à l'augmentation domine le signal. Il ne semble pas avoir de cycle dans cette série.

Au vu de l'aspect général du graphique de la série, nous ne pencherions pas sur de grosses variations de tendances locales (plutôt une tendance générale qui domine) mais réalisons quand même un graphique de ces tendances locales pour en être sûr :

```{r shop21_localtrend}
shop21_local <- local.trend (shop21_ts, xlab = "Temps [mois]", ylab = "Sommes cumulées (CUSUM)", main = "Tendances locales de la série 2021 \n sur le déplacement vers les commerces et loisirs")
#Visualiser la possible rupture (minimum de CUSUM)
abline(v = time(shop21_local)[which.min(shop21_local)], col = "red", lty = 3)
```

Les sommes cummulées montrent une rupture au milieu de l'année, montrant qu'il y a deux phases dans la série. Cette allure en U de la courbe rouge montre que la série commence sous le niveau de référence et finit au dessus, ce qui confirme la sensation d'augmentation générale avec l'allure de la série 2021.

Décomposons notre série pour vérifier qu'il n'y a une tendance générale qui domine :

```{r shop21_filtrage_evf}
shop21_evf <- tsd (shop21_ts, method = "evf", lag = 30, axes = 1)
plot (shop21_evf, col = 1:3, 
  xlab = "Temps", 
  main = "Filtrage de la série 2021 par valeur propre")
```

Effectivement, une tendance générale à l'augmentation domine la série, comme cela pouvait facilement se voir sur le graphique brut de la série 2021. Pour en être sûr, nous réalisons un test de bootstrap afin de vérifier que cette tendance soit bien significative.

```{r test_tendance_shop20}
shop21_filtered <- extract (shop21_evf, components = "filtered")
plot (trend.test(shop21_filtered, R = 100))
```

Nous pouvons voir que la tendance générale à l'augmentation pour cette série est significative au seuil alpha de 5%, et nous rejetons donc H0. La tendance générale qui domine le signal dans cette série est donc significative.

Pour vérifier la présence ou l'absence de cycle dans les résidus, nous réalisons une analyse spectrale :

```{r}
shop21_residual <- extract (shop21_evf, components = "residuals")
plot (shop21_residual, xlab = "Temps [mois]", main = "Résidus de la décomposition de la série des déplacements en 2021")
acf (shop21_residual, main = "Autocorrelation des résidus")
spectrum (shop21_residual, spans = c(3,5), main = "Analyse spectrale des résidus")
```

Plusieurs cycles significatifs sont présents dans cette série. - Un pic de fréquence d'environ 10, qui correspond à un cycle se déroulant donc environ tous les 36 jour et demi - Un pic à une fréquence de 50, ce qui signifie 50 cycles en une année, donc un cycle d'à pe u près 7 jours - Un pic à une fréquence de 100, ce qui signifie un cycle d'à peu près 3 jours et demi - Un pic à une fréquence de 150, qui correspond à un cycle d'à peu 2 jours et demi.

#### Comparaison 2020 20201

La série, qui mesure les variations de déplacement vers les commerces et les lieux de loisirs au cours du temps, est très différente entre l'année 2020 et 2021.

En effet, en 2020, la série est caractérisée par des tendances locales assez marquées, qui divisent l'année en plusieurs phases de croissance et de décroissance. Une tendance générale à l'augmentation se profile également, étant significative, mais moins marquée et visible sur la série brute de la série. Pas de cycles de déplacements significatifs sont présents au cours de cette année 2020.

Au contraire, pour l'année 2021, la série n'est pas marquée par autant de phases de croissance et de décroissance coupant l'année, et les sommes cumulées ont montrées qu'un point de rupture et deux phases dans l'année.\
Par contre, l'allure générale incite plus à penser qu'une tendance globale à l'augmentation existe dans cette série. Et en effet, cette tendance globale est significative. En plus de cela, des cycles significatifs sont présents, à différents intervalles de jours, signifiant que les déplacements se font parfois à différents intervalles réguliers selon les observations.

### Lieux de travail

La variable Lieux de travail correspond aux déplacements de la population wallone, en Belgique, vers leur lieu de travail. Nous allons comparer ces déplacements pour l'année 2020 et 2021.

#### Année 2020

```{r serie_travail_2020}
ts_work<- ts(covid$workplaces, start = c(2020,46),frequency = 365)
ts_work <- window(ts_work, start = c(2020,46), end = c(2020,365))
class(ts_work)
plot(ts_work, xlab = "Temps [mois]", ylab = "Déplacements", main = "Année 2020 - Déplacements vers le lieu de travail")
tsp(ts_work)
```

La série montre une chute des déplacements au travail à partir de mars avant de remonter progressivement jusqu'en août. Ensuite cela diminue à nouveau jusqu'au mois de septembre pour remonter ensuite en début décembre. Enfin, une autre rechute brève et forte apparait en fin d'année pour ensuite remonter et se stabiliser.

```{r acf_travail_2020 }
acf(ts_work, main = "Graphique d'autocorrélation 2020")
```

Ce graphique d'autocorrélation ne semble pas présenter de cycle ni de tendance générale.

```{r tendance_locale_2020work}
local.trend(ts_work) 
```

Le graphique de la tendance locale montre un diminution à partir du mois d'avril. Ensuite, une petite augmentation se marque à partir du mois d'Août suivie d'une petite période stagnante avant de remonter au mois d'octobre pour ensuite stagner jusqu'à la fin de l'année.

Nous réalisons une décomposition de la série afin d'analyser cette dernière plus en détail :

```{r evftravail_2020}
covidw2020 <- tsd(ts_work, method = "evf", lag = 20, axes = 1)
plot(covidw2020,col = 1:3, main = "Filtrage par les valeurs propres", ylab = "Série", xlab = "Temps [semaines]")
```

Les résidus semblent indiquer qu'il n'y a aucun cycle. De manière générale, lorsque l'on observe la composante filtrée, bien qu'au début de la série il y ait une diminution importante des fréquentations au travail, le reste de la série semble présenter une tendance générale croissante. Nous vérifions s'il existe une tendance générale significative :

```{r tendancetravail_2020}
extract_2020 <- extract(covidw2020, components = "filtered")
trend.test(extract_2020)
```

La p value étant inférieure à \alpha au seuil de 5%, la tendance générale est donc significative. De plus elle est croissante car la valeur de \rho est positive.

Pour être certains que les séries ne présentent aucun cycles, nous décidons d'analyser leur potentielle présence avec une analyse spectrale :

```{r residtravail_2020}
extract_whole_20 <- extract(covidw2020, components = "residuals")
plot(extract_whole_20)
spectrum(extract_whole_20, spans= c(3,5))
```

Deux cycles significatifs sont observés en 2020. Un pic à une fréquence de 50, ce qui signifie un cycle tous les 7,3 jours et un autre pic à une fréquence de 100 jours ce qui signifie un cycle tous les 3,65 jours.

####Année 2021

```{r serie_travail_2021}
# La série temporelle est créée (début le 1er janvier 2021)
ts_work21 <- ts(covid$workplaces, start = c(2020, 46), frequency = 365)
ts_work21 <- window(ts_work21, start = c(2021, 1), end = c(2021, 365), frequency = 366)
class(ts_work21)
plot(ts_work21, xlab = "Temps [mois]", ylab = "Déplacements", main = "Année 2021 - Déplacements vers le lieu de travail")
```

La série ne semble pas présenter de grosses chutes liées aux déplacements vers les lieux de travail si ce n'est quelques chutes aigües et brèves à certains moments de l'année.

```{r acf_travail_2021 }
acf(ts_work21, main = "Graphique d'autocorrélation 2021")
```

Ce graphique d'autocorrélation ne semble pas non plus avoir de cycles ni de tendance générale avec seulement quelques barres significatives.

```{r tendance_locale_2021work}
local.trend(ts_work21) 
```

Il semble y avoir deux tendances locales, une première entre avril et juillet 2021. Une seconde se situe entre juillet et octobre.

Nous décomposons la série afin de l'analyser plus en détail :

```{r evftravail_2021}
covidw2021 <- tsd(ts_work21, method = "evf", lag = 20, axes = 1)
plot(covidw2021, col = 1:3, main = "Filtrage par les valeurs propres", ylab = "Série", xlab = "Temps [semaines]")
```

La composante filtrée ne montre pas de tendance claire. De plus, les résidus ne semblent pas montrer de cycle.

Nous allons vérifier si il existe une tendance générale dans la série. Par contre il ne semble pas y avoir de cycles.

```{r tendancetravail_2021}
extract_2021 <- extract(covidw2021, components = "filtered")
trend.test(extract_2021)
```

La p value étant inférieure à \alpha au seuil de 5%, la tendance générale est donc significative. De plus elle est croissante car la valeur de \rho est positive.

```{r residtravail_2021}
 covid_extract_2021 <-extract(covidw2021, components = "residuals")
plot(covid_extract_2021, ylab = "Résidus", xlab = "Temps [mois]")
spectrum(covid_extract_2021, spans = c(3,5), main = "Périodogramme lissé", ylab = "spectre", xlab = "frequency")
```

Tout comme 2020, deux cycles significatifs sont observés à une fréquence de 50, ce qui signifie un cycle tous les 7.3 jours et un autre pic à une fréquence de 100 jours ce qui signifie un cycle tous les 3.65 jours. Il y a ici, un troisième cycle avec une fréquence d'environ 160 qui se marque. Ce cycle est donc un cycle qui se déroule tous les 2.3 jours.

#### Comparaison lieux de travail 2020-2021

Si nous nous intéressons à l'année entière, 2020 et 2021 présentent une tendance générale à l'augmentation. De plus, les deux séries ont bien des cycles de fréquence 50 et 100 jours. Avec 2021 qui présente un cycle supplémentaire de fréquence 160. La tendance locale est principalement marquée en 2020 avec une baisse des fréquentations au travail entre avril et octobre.

### Alimentation et pharmacies

La variable alimentation et pharmacies correspond à l’évolution des déplacements de la population wallonne vers les commerces alimentaires et pharmacies. Ces déplacements sont essentiels et donc moins sensibles aux restrictions que d’autres types de mobilité. Nous analysons cette série pour les années 2020 et 2021.

#### Année 2020

```{r serie grocery_pharma2020}
grocery_pharma_ts <- ts(window(covid$grocery_pharma, start = 1, end = 321),start = c(2020, 46), end = c(2020, 366), frequency = 366)
plot(grocery_pharma_ts, ylab = "déplacement supermarchés et pharmacies", xlab = "temps [mois]", main = "Déplacement supermarchés et pharmacies en 2020")
```

Ce graphique représente l'évolution des déplacements vers les supermarchés et les pharmacies durant l'année 2020 en période de covid. On aperçoit une chute brutale de la série en début d'année. Ensuite, la série se stabilise autour d'une tendance négative, puis, elle remonte légèrement à la fin de l'année. On observe également un pic le 11 mars, quelques jours avant la chute brutale qui correspond à la date de déclaration officielle de pandémie par l’OMS.

```{r serie grocery_pharma2020 sep}
covidw_ts <- ts(covidw$grocery_pharma, start = c(2020, 46), frequency = 365,end = c(2020, 365))
# Aggrégation par moyenne des valeurs par semaine
covidw_gp_ts2 <- aggregate(covidw_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidw_gp_ts2)

covidy_ts <- ts(covidy$grocery_pharma, start = c(2020, 46), frequency = 365,end = c(2020, 365))
# Aggrégation par moyenne des valeurs par semaine
covidy_gp_ts2 <- aggregate(covidy_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidy_gp_ts2)

par(mfrow = c(1, 2), mar = c(4, 4, 3, 1))
plot(covidw_gp_ts2, ylab = "déplacement supermarchés et pharmacies", xlab = "temps [mois]", main = "Déplacement supermarchés et pharmacies semaine en 2020", cex.main = 0.6,cex.lab = 0.5,cex.axis = 0.4)
plot(covidy_gp_ts2, ylab = "déplacement supermarchés et pharmacies", xlab = "temps [mois]", main = "Déplacement supermarchés et pharmacies week-end en 2020", cex.main = 0.6,cex.lab = 0.5,cex.axis = 0.4)
```

Lorsque l'on regarde la tendance générale de la série pour 2020 semaine comparativement à celle de 2020 week-end, aucune différence notable ne semble se dégager. En effet, les deux séries semblent avoir une apparence similaire, c'est pour cette raison que nous poursuivrons notre analyse sans séparer la semaine du week-end.

#### Année 2021

```{r serie grocery_pharma2021}
grocery_pharma_ts2 <-  ts(window(covid$grocery_pharma, start = 322, end = 686),start = c(2021, 1), end = c(2021, 365), frequency = 366)
plot(grocery_pharma_ts2, ylab = "déplacement supermarchés et pharmacies", xlab = "temps [mois]", main = "Déplacement supermarchés et pharmacies en 2021")
```

Ce graphique montre l'évolution des déplacements vers les supermarchés et les pharmacies durant l'année 2021 en période covid. À première vue, la série ne semble pas présenter de pic. En effet, la série connaît une hausse en début d'année, puis semble se maintenir stable avant de repartir à la hausse en fin d'année.

#### Comparaison année 2020 et année 2021

```{r serie grocery_pharma2020_2021}
grocery_pharma_ts <- ts(window(covid$grocery_pharma, start = 1, end = 321),start = c(2020, 46), end = c(2020, 366), frequency = 366)
plot(grocery_pharma_ts)

grocery_pharma_ts2 <-  ts(window(covid$groc, start = 322, end = 686),start = c(2021, 1), end = c(2021, 365), frequency = 366)
plot(grocery_pharma_ts2)


par(mfrow = c(1, 2), mar = c(4, 4, 3, 1))
plot(grocery_pharma_ts, ylab = "déplacement supermarchés et pharmacies", xlab = "temps [mois]", main = "Déplacement supermarchés et pharmacies en 2020", cex.main = 0.7,cex.lab = 0.6,cex.axis = 0.5)
plot(grocery_pharma_ts2, ylab = "déplacement supermarchés et pharmacies", xlab = "temps [mois]", main = "Déplacement supermarchés et pharmacies en 2021", cex.main = 0.7,cex.lab = 0.6,cex.axis = 0.5)

```

Quand on examine l'allure générale de la série pour 2020 par rapport à celle de 2021, les différences semblent assez marquées. D'une part, en 2020, nous constatons une baisse au début de l'année, tandis que d'autre part, en 2021, la tendance de la série paraît à la hausse en début d'année. Toutefois, à mi-parcours de l'année, on observe une stabilisation des deux séries, et en fin d'année, elles montrent toutes deux une tendance à la hausse.

```{r autocorrélation2020gp}
acf(grocery_pharma_ts)
```

L’autocorrélation reflète principalement la persistance temporelle liée à la tendance et aux chocs successifs, plutôt qu’une véritable composante cyclique. Toutefois, on observe également une tendance générale négative. Les dernières valeurs sont à la marge de l'enveloppe de confiance de 95%.

Décomposons la série :

```{r decomp2020gp}
grocery_pharma_ts2020 <- tsd(grocery_pharma_ts, method = "average", type = "additive", order = 26, times = 3)
plot(grocery_pharma_ts2020, col = 1:3)
```

Au niveau de la série filtrée, on observe une chute suivit d'une tendance générale croissante sur l'année 2020. Dans les résidus, aucun cycle net est aperçu. Les résidus sont relativement centrés autour de zéro, avec quelques valeurs extrêmes.

Analysons la tendance générale :

```{r trend2020gp}
grocerypharma_2020f <- extract(grocery_pharma_ts2020, components = "filtered")
acf(grocerypharma_2020f)
trend.test(grocerypharma_2020f)
```

La p-value du test de tendance est inférieure à 5 % (p-value = 2.2\^-16), ce qui conduit au rejet de l’hypothèse nulle. Il existe donc une tendance générale significative et croissante des déplacements vers les commerces alimentaires en 2020. La valeur du coefficient de tendance \rho est positive et égale à 0,701, indiquant une tendance marquée.

Analysons les résidus :

```{r residuals2020gp}
grocerypharma_res_2020 <- extract(grocery_pharma_ts2020, components = "residuals")
plot(grocerypharma_res_2020)
spectrum(grocerypharma_res_2020, spans = c(3,5))
```

À partir du periodogramme lissé, nous pouvons observer que le spectre présente plusieurs maxima locaux. Plusieurs pics sont significatifs ce qui suggère un cycle régulier d'une fréquence de 10, 55, 100, 140 et 170.Cela signifie qu'on a cinq cycles : un de 36,5 jours, un de 6,6 jours, un de 3,65 jours, un de 2,6 jours un de 2,15 jours.

Réalisons un local.trend pour savoir si notre série possède une tendance locale.

```{r}
grocerypharma_local_2020 <- local.trend(grocery_pharma_ts)
 
plot(grocerypharma_local_2020)
```

La courbe présente une évolution très marquée en plusieurs phases, avec une dynamique clairement non linéaire. Au début de la période, la courbe monte rapidement. La pente est forte et régulière, ce qui traduit une hausse rapide du nombre de déplacement jusqu’à un pic net. Ce sommet est assez pointu, signe d’un maximum atteint sur une période courte.Après ce pic, la courbe s’inverse brutalement. La descente est très raide, beaucoup plus rapide que la montée initiale. Cela donne une impression de rupture ou de choc, avec une perte en termes de nombre de déplacement importante en peu de temps. La courbe atteint ensuite un minimum profond, formant un creux relativement arrondi. À ce stade, les variations sont plus faibles, ce qui suggère une phase de stabilisation temporaire autour du point le plus bas. À partir de ce creux, on observe une remontée lente et continue. La pente est beaucoup plus douce que lors de la chute, indiquant une récupération progressive du nombre de déplacement plutôt qu’un rebond brutal. En fin d'année, la courbe continue globalement à monter, mais avec de petites oscillations : alternance de hausses et de légers replis. Cela donne un aspect plus irrégulier, suggérant une phase d’ajustement ou d’incertitude.

#### Année 2021

```{r autocorrélation2021gp}
acf(grocery_pharma_ts2)
```

Le graphique d'autocorrélation de 2021 indique essentiellement une stabilisation sans cycles évidents. La tendance générale semble être constante.

Décomposons la série :

```{r decomp2021gp}
grocery_pharma_ts2021 <- tsd(grocery_pharma_ts2, method = "average", type = "additive", order = 26, times = 3)
plot(grocery_pharma_ts2021, col = 1:3)
```

La composante filtrée révèle une progression plutôt lente et constante en début d'année, puis une période de stabilisation jusqu'à la fin de la période, bien qu'une légère augmentation soit perceptible en toute fin d'année. Les résidus sont généralement répartis autour de zéro et n'affichent aucun cycle discernable, bien que certaines valeurs extrêmes se manifestent occasionnellement.

Analysons la tendance générale :

```{r trend2021gp}
grocerypharma_2021f <- extract(grocery_pharma_ts2021, components = "filtered")
acf(grocerypharma_2021f)
trend.test(grocerypharma_2021f)
```

Comme pour la série 2020, dans celle de 2021 la p-value du test de tendance est inférieure à 5 % (p-value = 2.2\^-16), ce qui conduit au rejet de l’hypothèse nulle. Il existe donc une tendance générale significative et hautement croissante des déplacements vers les commerces alimentaires et les pharmacies en 2021. De plus, la valeur du coefficient rho est plus élevée (rho = 0,928), suggérant une tendance plus prononcée qu’en 2020.

```{r residuals2021gp}
grocerypharma_res_2021 <- extract(grocery_pharma_ts2021, compoenents = "residuals")
plot(grocerypharma_res_2021)
spectrum(grocerypharma_res_2021, spans = c(3,5))
```

Le periogramme montre que nous n'avons pas de cycle significatif dans la série.

Analysons la tendance locale :

```{r}
grocerypharma_local_2021 <- local.trend(grocery_pharma_ts2)
 
plot(grocerypharma_local_2021)
```

Le graphique montre clairement deux phases sur l’année 2021. En début d’année, la ligne rouge décroît fortement jusqu’à atteindre un minimum autour de mars–avril, ce qui indique une accumulation d’écarts négatifs et donc une baisse structurelle de la série par rapport à sa tendance locale. À partir de ce point, la pente du CUSUM s’inverse : il remonte progressivement jusqu’à la fin de l’année, traduisant un redressement durable et un retour vers des niveaux supérieurs à la référence. On observe donc une rupture de tendance au printemps 2021, avec un passage d’une phase de dégradation à une phase de reprise. Les pics ponctuels de la série en pointillés correspondent à des chocs isolés, mais ils n’affectent pas la dynamique globale, qui est dominée par ce changement de régime en milieu d’année.

#### Comparaison 2020 et 2021

En 2020, la série des déplacements vers les commerces alimentaires et pharmacies est fortement marquée par le choc du début de la crise sanitaire. On observe une chute brutale en début d'année (mars), suivie d’une stabilisation à un niveau inférieur à la normale, puis d’une légère reprise en fin d’année. La décomposition met en évidence une tendance générale croissante sur l’ensemble de l’année, mais celle-ci masque une forte rupture initiale. Les résidus présentent plusieurs cycles significatifs, suggérant une structure périodique plus marquée en 2020, probablement liée aux alternances de restrictions et de comportements d’adaptation. Le CUSUM confirme une phase de dégradation rapide suivie d’un ajustement progressif, sans véritable retour au niveau initial.

En 2021, en revanche, aucune chute brutale n’est observée en début d’année. La série est croissante dès le début, puis elle se stabilise au cours de l’année avant de connaître une nouvelle hausse en fin de période. La tendance estimée est significative et plus marquée qu’en 2020, traduisant une dynamique de reprise plus régulière. Les résidus sont globalement centrés autour de zéro et ne présentent pas de cycle significatif, indiquant une série plus stable et mieux structurée. Le CUSUM met en évidence une phase de redressement à partir du printemps, sans choc initial comparable à celui observé en 2020.

En comparaison, 2020 apparaît comme une année de choc et d’adaptation, caractérisée par une forte rupture initiale et une dynamique instable, tandis que 2021 correspond davantage à une année de reprise progressive, avec une tendance plus marquée, moins de cyclicité et une évolution plus régulière des déplacements vers les commerces alimentaires et pharmacies.

### Lieux de résidence

#### Année 2020

```{r serie_résid_2020}
res_20 <- ts(window(covid$residential, start = 1, end = 321),start = c(2020, 46), end = c(2020, 366), frequency = 366)
class(res_20)
```

Que ce soit pour le travail ou pour d'autres activités, la population quitte sa résidence globalement tous les jours de la semaine. Nous ne séparons donc pas les données entre jours de la semaine et jours de weekend. Jetons un oeil à cette série chronologique en imprimant son graphe.

```{r res20_plot}
plot(res_20, xlab = "Temps [mois]", ylab = "Evolution du nombre de personnes [%]", main = "Lieux de résidence - 2020")
tsp(res_20)
```

A cette étape, il est encore très difficile d'interpréter la série chronologique. Il y a beaucoup de bruit. Cependant, nous observons une brusque augmentation (+ 30%) de personnes restant chez elles début d'année 2020, illustrant l'arrivée soudaine de la quarantaine. On observe également une réduction de cette augmentation durant l'été. Vérifions l'autocorrélation.

```{r acf_2020}
acf(res_20, main = "Autocorrélation pour l'année 2020")
```

L'autocorrélation est forte. Toutes les barres sont significatives et positives. De plus, on distingue une décroissance, révélant une tendance générale à la diminution. Il ne semble pas y avoir de cycle. Afin de diminuer le bruit, décomposons la série avec un filtrage par les valeurs propres, pour déterminer quelle composante a la plus forte variance.

```{r tsd_2020}
res_20_dec <- tsd(res_20, method = "evf", lag = 20, axes = 1)
plot(res_20_dec, xlab = "Temps [jours]", col = 1:3)
```

La série est dominée par une tendance. On observe une tendance générale à l'augmentation début d'année 2020, suivie d'une diminution en été, pour réaugmenter fin d'année. Analysons ces changements de tendance avec la méthode des sommes cumulées.

```{r lt_2020}
res_20_lt <- local.trend(res_20, xlab = "Temps [mois]")
```

On observe bien deux phases principales : une augmentation à partir du mois d'avril, suivie d'une diminution à la transition juin-juillet. Une nouvelle augmentation est également observable début octobre.

Nous réalisons désormais une vérification concernant les cycles.

```{r extract_2020}
extract_res_20 <- extract(res_20_dec, components = "residuals")
plot(extract_res_20, ylab = "Composante résiduelle", xlab = "Temps [mois]")
```

La composante résiduelle de la série étant extraite, cette série est stationnarisée et nous pouvons dès lors réaliser une analyse spectrale.

```{r spec_2020}
spectrum(extract_res_20, spans = c(3, 5), ylab = "Spectre", xlab = "Fréquence", main = "Analyse spectrale - ")
```

Le périodogramme lissé détecte la présence de cycles significatifs à \~ 60 et 110 jours, soit des cycles bimestriel et quadrimestriel.

#### Année 2021

```{r serie_2021}
res_21 <- ts(window(covid$residential, start = 322, end = 686),start = c(2021, 1), end = c(2021, 365), frequency = 365)
class(res_21)
```

Imprimons le graphe de cette série chronologique.

```{r res21_plot}
plot(res_21, xlab = "Temps [mois]", ylab = "Evolution du nombre de personnes [%]", main = "Lieux de résidence - 2021")
tsp(res_21)
```

```{r acf_2021}
acf(res_21, main = "Autocorrélation pour l'année 2021")
```

On observe une autocorrélation, avec des barres toutes positives et significatives. Il ne semble pas y avoir de cycle. Décomposons la série avec un filtrage par les valeurs propres pour réduire le bruit.

```{r tsd_2021}
res_21_dec <- tsd(res_21, method = "evf", lag = 20, axes = 1)
plot(res_21_dec, col = 1:3, xlab = "Temps [jours]")
```

Une tendance domine la série. La courbe montre une diminution, suivie d'une augmentation. Appliquons la méthode des sommes cumulées pour étudier ces changements de tendance.

```{r lt_2021}
res_21_lt <- local.trend(res_21, xlab = "Temps [mois]")
```

La tendance locale à l'augmentation culmine vers le mois de mai, et une tendance locale à la diminution enchaîne directement, pour stagner en fin d'année.

Nous réalisons désormais une vérification concernant les cycles.

```{r extract_2021}
extract_res_21 <- extract(res_21_dec, components = "residuals")
plot(extract_res_21, ylab = "Composante résiduelle", xlab = "Temps [mois]")
```

La composante résiduelle de la série étant extraite, cette série est stationnarisée et nous pouvons dès lors réaliser une analyse spectrale.

```{r spec_2021}
spectrum(extract_res_21, spans = c(3, 5), ylab = "Spectre", xlab = "Fréquence", main = "Analyse spectrale - ")
```

Le périodogramme lissé détecte la présence de cycles significatifs à \~ 60, 110 et 160 jours, soit des cycles bimestriel, quadrimestriel et semestriel.

#### Comparaison des années 2020 et 2021

Que ce soit pour 2020 ou 2021, on observe une nette autocorrélation, et une tendance domine la série chronologique. Des cycles bimestriels et quadrimestriels sont visibles pour les deux années. L'année 2021 contient également un cycle semestriel.

Début du mois d'avril 2020, on observe une nette augmentation (+ 30%) du nombre de personnes restant chez elles : c'est le début de la quarantaine. Cette augmentation diminue ensuite à la transition juin-juillet pour atteindre son taux le plus bas en fin des vacances d'été, où les gens sortaient plus de chez eux pour profiter du beau temps, malgré la pandémie. Début octobre, la tendance remonte, illustrant la reprise des cours en ligne et du télétravail d'un grand pourcentage de la population.

L'année 2021 débute avec un taux d'augmentation d'environ 15%. Ce taux continue de grimper jusqu'à culminer vers le mois de mai, pour redescendre fortement ensuite, et atteindre un pallier fin 2021. Cette chute illustre l'allègement des mesures relatives à la pandémie, avec notamment la reprise totale des cours en présentiel pour les étudiants.

En résumé, l'année 2020 connut le plus grand taux d'augmentation du nombre de personnes restant dans leur lieu de résidence. En effet, l'année 2021 montra déjà une légère diminution par rapport à 2020, permise par les progrès médicaux et les premiers effets de l'immunité collective. De plus, la période estivale, accompagnée du beau temps, s'est avérée être la période avec le taux d'augmentation le plus faible, et ce pour les deux années.

# Conclusion

<!--% Lorsque toutes les analyses sont réalisées, terminez ce bloc-notes avec 3 à 6 phrases de conclusion en rapport avec ce que vous avez observé dans vos analyses. Quels sont les éléments les plus pertinents que vous retenez ? -->

...vos conclusions ici...
